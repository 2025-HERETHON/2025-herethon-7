{% extends "base_menu.html" %} 
{% load static %}
{% block title %}감정 탐색{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/filter_reviews.css' %}" />
{% endblock %} 

{% block content %}
<h2>감정별 모아보기</h2>
<form method="get" action="{% url 'contents:filter_reviews' %}">
    {% if request.GET.book_id %}
        <input type="hidden" name="book_id" value="{{ request.GET.book_id }}">
    {% endif %}

    {% for tag in tags %}
        <label style="margin-right:8px;">
            <input type="checkbox" name="tags" value="{{ tag.id }}"
                {% if tag in selected_tags %}checked{% endif %}>
            #{{ tag.name }}
        </label>
    {% endfor %}

    <select name="sort" style="margin-left: 16px;">
        <option value="recent" {% if sort == "recent" %}selected{% endif %}>최신순</option>
        <option value="popular" {% if sort == "popular" %}selected{% endif %}>인기순</option>
    </select>

    <button type="submit">필터 적용</button>
</form>
<hr>

{% if book_title %}
    <h3>"{{ book_title }}"에 대한 리뷰 모음</h3>
{% endif %}

{% for review in reviews %}
    <div style="margin-bottom: 16px; display: flex; align-items: flex-start;">
        {% if review.book.thumbnail %}
            <img src="{{ review.book.thumbnail }}" alt="썸네일" width="80" style="margin-right: 12px;">
        {% endif %}
        
        <div>
            <a href="{% url 'contents:detail' review.id %}" style="text-decoration: none; color: inherit;">
                <b>{{ review.book.title }}</b> - {{ review.short_comment }}
            </a>
            <div>
                {% for tag in review.tags.all %}
                    <span style="border:1px solid #ccc; border-radius:12px; padding:2px 8px;">#{{ tag.name }}</span>
                {% endfor %}
            </div>
        </div>
    </div>
{% empty %}
    <p>해당 감정을 모두 포함하는 리뷰가 없습니다.</p>
{% endfor %}

<br>
<a href="{% url 'contents:main' %}">메인페이지로 돌아가기</a>
{% endblock %}
